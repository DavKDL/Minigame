<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minigame Setas Sequenciais com Som</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #fff;
      transition: background-color 0.3s;
      color: #000;
      user-select: none;
    }
    #instructions {
      font-size: 18px;
      margin-bottom: 30px;
      text-align: center;
      max-width: 300px;
    }
    #arrow-box {
      font-size: 100px;
      margin-bottom: 20px;
      height: 120px;
      line-height: 120px;
      user-select: none;
      transition: transform 0.2s ease, color 0.2s ease;
      display: inline-block;
    }
    /* Efeito visual quando tecla correta */
    .correct-press {
      animation: pulse 0.3s ease;
      color: #4CAF50;
    }
    @keyframes pulse {
      0% {
        transform: scale(1);
        color: #4CAF50;
      }
      50% {
        transform: scale(1.3);
        color: #81C784;
      }
      100% {
        transform: scale(1);
        color: #4CAF50;
      }
    }
    #start-btn {
      font-size: 30px;
      padding: 20px 40px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      transition: background-color 0.3s;
      user-select: none;
    }
    #start-btn:hover {
      background-color: #0056b3;
    }
    #result-symbol {
      font-size: 150px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      user-select: none;
      display: none;
    }
    #time-taken {
      margin-top: 20px;
      font-size: 24px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div id="instructions">
    Pressione as teclas na ordem!<br>
    Use Setas ou WASD — você escolhe!
  </div>

  <div id="arrow-box"></div>

  <button id="start-btn">Começar Jogo</button>

  <div id="time-taken"></div>
  <div id="result-symbol"></div>

  <script>
    const arrowToWasd = { 'ArrowUp': 'W', 'ArrowDown': 'S', 'ArrowLeft': 'A', 'ArrowRight': 'D' };
    const arrows = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
    const arrowSymbols = {
      ArrowUp: '↑',
      ArrowDown: '↓',
      ArrowLeft: '←',
      ArrowRight: '→'
    };

    let sequence = [];
    let currentIndex = 0;
    let startTime = 0;
    let gameRunning = false;

    const arrowBox = document.getElementById('arrow-box');
    const startBtn = document.getElementById('start-btn');
    const resultSymbol = document.getElementById('result-symbol');
    const timeTakenDiv = document.getElementById('time-taken');

    // Função para tocar beep simples usando Web Audio API
    function playBeep() {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();

      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // frequência 440Hz (Lá)
      gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); // volume baixo

      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.1); // dura 0.1s

      oscillator.onended = () => {
        audioCtx.close();
      };
    }

    function generateSequence(length = 10) {
      sequence = [];
      for(let i = 0; i < length; i++) {
        sequence.push(arrows[Math.floor(Math.random() * arrows.length)]);
      }
    }

    function showArrow(index) {
      if(index >= sequence.length) {
        endGame(true);
        return;
      }
      arrowBox.textContent = arrowSymbols[sequence[index]];
      arrowBox.style.color = '#000'; // reset cor ao mostrar seta nova
    }

    function endGame(success) {
      gameRunning = false;
      document.removeEventListener('keydown', handleKey);

      let elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
      timeTakenDiv.textContent = `Tempo: ${elapsed} segundos`;

      if(success) {
        document.body.style.backgroundColor = '#4CAF50';
        resultSymbol.textContent = '✓';
        resultSymbol.style.color = '#fff';
      } else {
        document.body.style.backgroundColor = '#f44336';
        resultSymbol.textContent = '✗';
        resultSymbol.style.color = '#fff';
      }
      resultSymbol.style.display = 'block';

      arrowBox.textContent = '';
      startBtn.textContent = 'Reiniciar Jogo';
      startBtn.style.display = 'inline-block';
    }

    function handleKey(e) {
      if(!gameRunning) return;

      const key = e.key;
      const expected = sequence[currentIndex];
      const expectedWASD = arrowToWasd[expected];

      if (key === expected || key.toUpperCase() === expectedWASD) {
        // Toca o beep
        playBeep();

        // Efeito visual: adiciona classe que faz animação
        arrowBox.classList.add('correct-press');

        // Remove a classe depois que a animação terminar pra poder repetir
        arrowBox.addEventListener('animationend', () => {
          arrowBox.classList.remove('correct-press');
        }, { once: true });

        currentIndex++;
        if(currentIndex >= sequence.length) {
          endGame(true);
        } else {
          showArrow(currentIndex);
        }
      } else {
        endGame(false);
      }
    }

    function startGame() {
      document.body.style.backgroundColor = '#fff';
      resultSymbol.style.display = 'none';
      timeTakenDiv.textContent = '';
      currentIndex = 0;
      generateSequence();
      showArrow(0);
      startTime = Date.now();
      gameRunning = true;
      startBtn.style.display = 'none';

      document.addEventListener('keydown', handleKey);
    }

    startBtn.addEventListener('click', startGame);
  </script>

</body>
</html>
